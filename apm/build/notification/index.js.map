{"version":3,"sources":["../../src/notification/index.js"],"names":["sendToSlack","data","slackMessage","Slack","generateMessage","postToChannel","process","env","SLACK_INCOMING_WEBHOOK","sendToTwilio","criticalServer","find","e","status","Constant","HEALTH_CHECK_STATUS","CRITICAL","callMessage","project","phones","TWILIO_TO_PHONE","listPhone","split","all","filter","phone","map","Twilio","sendCall"],"mappings":";;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,cAAc,SAAdA,WAAc,CAACC,IAAD,EAAU;AAC5B,MAAMC,eAAeC,gBAAMC,eAAN,CAAsBH,IAAtB,CAArB;AACA,SAAOE,gBAAME,aAAN,CAAoBC,QAAQC,GAAR,CAAYC,sBAAhC,EAAwDN,YAAxD,CAAP;AACD,CAHD;;AAKA,IAAMO,eAAe,SAAfA,YAAe,CAACR,IAAD,EAAU;AAC7B,MAAMS,iBAAiBT,KACpBU,IADoB,CACf,UAACC,CAAD;AAAA,WAAOA,EAAEC,MAAF,KAAaC,mBAASC,mBAAT,CAA6BC,QAAjD;AAAA,GADe,CAAvB;AAEA,MAAIN,cAAJ,EAAoB;AAClB,QAAMO,+BAA6BP,eAAeQ,OAAlD;AACA,QAAMC,SAASb,QAAQC,GAAR,CAAYa,eAAZ,IAA+B,EAA9C;AACA,QAAMC,YAAYF,OAAOG,KAAP,CAAa,GAAb,CAAlB;AACA,WAAO,kBAAQC,GAAR,CAAYF,UAChBG,MADgB,CACT,UAACC,KAAD;AAAA,aAAWA,KAAX;AAAA,KADS,EAEhBC,GAFgB,CAEZ,UAACD,KAAD;AAAA,aAAWE,iBAAOC,QAAP,CAAgBX,WAAhB,EAA6BQ,KAA7B,CAAX;AAAA,KAFY,CAAZ,CAAP;AAGD;AACD,SAAOf,cAAP;AACD,CAZD;;kBAce;AACbV,0BADa;AAEbS;AAFa,C","file":"index.js","sourcesContent":["import Slack from './slack';\nimport Twilio from './twilio';\nimport Constant from '../monit/constant';\n\nconst sendToSlack = (data) => {\n  const slackMessage = Slack.generateMessage(data);\n  return Slack.postToChannel(process.env.SLACK_INCOMING_WEBHOOK, slackMessage);\n};\n\nconst sendToTwilio = (data) => {\n  const criticalServer = data\n    .find((e) => e.status === Constant.HEALTH_CHECK_STATUS.CRITICAL);\n  if (criticalServer) {\n    const callMessage = `apm-project-${criticalServer.project}`;\n    const phones = process.env.TWILIO_TO_PHONE || '';\n    const listPhone = phones.split(',');\n    return Promise.all(listPhone\n      .filter((phone) => phone)\n      .map((phone) => Twilio.sendCall(callMessage, phone)));\n  }\n  return criticalServer;\n};\n\nexport default {\n  sendToSlack,\n  sendToTwilio,\n};\n"]}