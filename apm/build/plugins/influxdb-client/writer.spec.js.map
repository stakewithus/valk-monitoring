{"version":3,"sources":["../../../src/plugins/influxdb-client/writer.spec.js"],"names":["describe","host","writer","it","linePoints","measurement","tags","location","fields","temperature","timestamp","dbName","lineMsg","post","query","db","precision","reply","res","writePoints","assert","equal","node_id","node_ip","node_pub_key","node_address","block_height","version_block","version_app","msg_timestamp","num_txs","evidence_hash","proposer_address"],"mappings":";;AAAA;;;;AACA;;AAGA;;AAIA;;;;AAIAA,SAAS,iBAAT,EAA4B,YAAM;AAChC,MAAMC,OAAO,uBAAb;AACA,MAAMC,SAAS,mBAAO;AACpBD;AADoB,GAAP,CAAf;AAGAD,WAAS,YAAT,EAAuB,YAAM;AAC3BG,OAAG,wEAAH,EAA6E,kBAAY;AACvF,UAAMC,aAAa,CAAC;AAClBC,qBAAa,SADK;AAElBC,cAAM;AACJC,oBAAU;AADN,SAFY;AAKlBC,gBAAQ;AACNC,uBAAa;AADP,SALU;AAQlBC,mBAAW;AARO,OAAD,CAAnB;AAUA,UAAMC,SAAS,uBAAf;AACA,UAAMC,UAAU,gEAAhB;AACA,0BAAKX,IAAL,EACGY,IADH,CACQ,QADR,EACkBD,OADlB,EAEGE,KAFH,CAES;AACLC,YAAIJ,MADC;AAELK,mBAAW;AAFN,OAFT,EAMGC,KANH,CAMS,GANT,EAMc,EANd;AAOA,UAAMC,MAAM,MAAMhB,OAAOiB,WAAP,CAAmBR,MAAnB,EAA2BP,UAA3B,CAAlB;AACAgB,mBAAOC,KAAP,CAAaT,OAAb,EAAsB,yBAAMR,UAAN,CAAtB;AACAgB,mBAAOC,KAAP,CAAaH,GAAb,EAAkB,KAAlB;AACD,KAvBD;AAwBAf,OAAG,uEAAH,EAA4E,kBAAY;AACtF,UAAMC,aAAa,CAAC;AAClBC,qBAAa,uBADK;AAElBC,cAAM;AACJgB,mBAAS,0CADL;AAEJC,mBAAS,gBAFL;AAGJC,wBAAc,8CAHV;AAIJC,wBAAc,0CAJV;AAKJC,wBAAc;AALV,SAFY;AASlBlB,gBAAQ;AACNmB,yBAAe,CADT;AAENC,uBAAa,CAFP;AAGNC,yBAAe,qBAHT;AAINC,mBAAS,CAJH;AAKNC,yBAAe,OALT;AAMNC,4BAAkB;AANZ,SATU;AAiBlBtB,mBAAW;AAjBO,OAAD,CAAnB;AAmBA,UAAMC,SAAS,uBAAf;AACA,UAAMC,UAAU,2YAAhB;AACA,0BAAKX,IAAL,EACGY,IADH,CACQ,QADR,EACkBD,OADlB,EAEGE,KAFH,CAES;AACLC,YAAIJ,MADC;AAELK,mBAAW;AAFN,OAFT,EAMGC,KANH,CAMS,GANT,EAMc,EANd;AAOA,UAAMC,MAAM,MAAMhB,OAAOiB,WAAP,CAAmBR,MAAnB,EAA2BP,UAA3B,CAAlB;AACAgB,mBAAOC,KAAP,CAAaT,OAAb,EAAsB,yBAAMR,UAAN,CAAtB;AACAgB,mBAAOC,KAAP,CAAaH,GAAb,EAAkB,IAAlB;AACD,KAhCD;AAiCD,GA1DD;AA2DD,CAhED","file":"writer.spec.js","sourcesContent":["import nock from 'nock';\nimport {\n  assert,\n} from 'chai';\nimport {\n  parse,\n} from './line-protocol';\n\nimport {\n  Writer,\n} from './index';\n\ndescribe('InfluxDB Writer', () => {\n  const host = 'http://127.0.0.1:8086';\n  const writer = Writer({\n    host,\n  });\n  describe('writePoint', () => {\n    it('it should write to the InfluxDB endpoint with a given host and payload', async () => {\n      const linePoints = [{\n        measurement: 'weather',\n        tags: {\n          location: 'us-midwest',\n        },\n        fields: {\n          temperature: 82,\n        },\n        timestamp: '1465839830100400200',\n      }];\n      const dbName = 'loom_tendermint_stats';\n      const lineMsg = 'weather,location=us-midwest temperature=82 1465839830100400200';\n      nock(host)\n        .post('/write', lineMsg)\n        .query({\n          db: dbName,\n          precision: 'ms',\n        })\n        .reply(200, {});\n      const res = await writer.writePoints(dbName)(linePoints);\n      assert.equal(lineMsg, parse(linePoints));\n      assert.equal(res, false);\n    });\n    it('it should write to the InfluxDB endpoint a real new block measurement', async () => {\n      const linePoints = [{\n        measurement: 'loom_tendermint_stats',\n        tags: {\n          node_id: '1739225062b349fa0805ba823dd0155165f40be3',\n          node_ip: '18.216.200.134',\n          node_pub_key: 'tjiLc0c2cbcDFjz/aW1j+r39sNsDwMLP1aO6UQhXvuk=',\n          node_address: 'F825EEB10F9CF76012FB155751B3A0437FC31442',\n          block_height: '2603315',\n        },\n        fields: {\n          version_block: 7,\n          version_app: 0,\n          msg_timestamp: '1550124342509575487',\n          num_txs: 0,\n          evidence_hash: '\"nil\"',\n          proposer_address: '\"C4BB2DA41B404044099DFBCD1F2537925D069EDC\"',\n        },\n        timestamp: '1550124344',\n      }];\n      const dbName = 'loom_tendermint_stats';\n      const lineMsg = 'loom_tendermint_stats,node_id=1739225062b349fa0805ba823dd0155165f40be3,node_ip=18.216.200.134,node_pub_key=tjiLc0c2cbcDFjz/aW1j+r39sNsDwMLP1aO6UQhXvuk\\\\=,node_address=F825EEB10F9CF76012FB155751B3A0437FC31442,block_height=2603315 version_block=7,version_app=0,msg_timestamp=1550124342509575487,num_txs=0,evidence_hash=\"nil\",proposer_address=\"C4BB2DA41B404044099DFBCD1F2537925D069EDC\" 1550124344';\n      nock(host)\n        .post('/write', lineMsg)\n        .query({\n          db: dbName,\n          precision: 'ms',\n        })\n        .reply(204, '');\n      const res = await writer.writePoints(dbName)(linePoints);\n      assert.equal(lineMsg, parse(linePoints));\n      assert.equal(res, true);\n    });\n  });\n});\n"]}